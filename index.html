<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Linemaster Print Count Resetter</title>
	<script src="https://code.jquery.com/jquery-3.2.1.js">
	</script>
<script>window.jQuery = window.$ = module.exports</script>
	<link href="node_modules\bootstrap\dist\css\bootstrap.css" rel="stylesheet" type="text/css">
	<link href="css\master.css" rel="stylesheet" type="text/css">
	<script src="main.js">
	</script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js">
	</script>
</head>
<body>
	<div class="col-xs-12" id="wrapper">
		<!-- START Instruction modal -->
		<input data-target="#infoModal" data-toggle="modal" src="img/info.png" type="image">
		<!-- END Instruction modal -->
		<img src='img/refresh.png' onclick="refreshCount()"/>
		<img src='img/close.png' onclick="closeWindow()"/>
		<img src='img/minimize.png' onclick="minimizeWindow()"/>
		<div class="row">
			<div class="col-xs-offset-3 col-xs-6" id="headerText"><img alt="" src="img/zebralogo2.png"></div>
			<div class="col-xs-offset-4 col-xs-4 text-left"></div>
		</div>
		<div id="resetButtons">
			<div class="row">
				<h2>Clean Printer</h2>
				<div class="col-xs-2 col-xs-offset-2">
					<button class="btn-primary" onclick="getSixHundredData()" type="button"><img alt="" src="img/copy.png"></button>
				</div>
				<div class="col-xs-4">
					<button class="btn-primary" onclick="cpSixHundred()" type="button">
					<h3>1-NPL-LP-1</h3>
					<h4 id="sixHundredCurrentCount"></h4></button>
				</div>
				<div class="col-xs-2" id="marginbottom">
					<button class="btn-primary" onclick="shell.openExternal(sixHundredUrl)" type="button"><img alt="" src="img/link.png"></button>
				</div>
				<div class="col-xs-2 col-xs-offset-2">
					<button class="btn-primary" onclick="getThreeHundredData()" type="button"><img alt="" src="img/copy.png"></button>
				</div>
				<div class="col-xs-4">
					<button class="btn-primary" onclick="cpThreeHundred()" type="button">
					<h3>1-NPL-LP-2</h3>
					<h4 id="threeHundredCurrentCount"></h4></button>
				</div>
				<div class="col-xs-2" id="marginbottom">
					<button class="btn-primary" onclick="shell.openExternal(threeHundredUrl)" type="button"><img alt="" src="img/link.png"></button>
				</div>
				<div class="col-xs-2 col-xs-offset-2">
					<button class="btn-primary" onclick="getshpOneData()" type="button"><img alt="" src="img/copy.png"></button>
				</div>
				<div class="col-xs-4">
					<button class="btn-primary" onclick="cpshpOne()" type="button">
					<h3>1-SHP-LP-1</h3>
					<h4 id="shpOneCurrentCount"></h4></button>
				</div>
				<div class="col-xs-2" id="marginbottom">
					<button class="btn-primary" onclick="shell.openExternal(shpOneUrl)" type="button"><img alt="" src="img/link.png"></button>
				</div>
				<div class="col-xs-2 col-xs-offset-2">
					<button class="btn-primary" onclick="getshpTwoData()" type="button"><img alt="" src="img/copy.png"></button>
				</div>
				<div class="col-xs-4">
					<button class="btn-primary" onclick="cpshpTwo()" type="button">
					<h3>1-SHP-LP-2</h3>
					<h4 id="shpTwoCurrentCount"></h4></button>
				</div>
				<div class="col-xs-2" id="marginbottom">
					<button class="btn-primary" onclick="shell.openExternal(shpTwoUrl)" type="button"><img alt="" src="img/link.png"></button>
				</div>
			</div>
			<div class="row">
				<h2>Replace Printhead</h2>
				<div class="col-xs-2 col-xs-offset-2">
					<button class="btn-primary" onclick="getSixHundredData()" type="button"><img alt="" src="img/copy.png"></button>
				</div>
				<div class=" col-xs-4">
					<button class="btn-primary" onclick="phSixHundred()" type="button">
					<h3>1-NPL-LP-1</h3>
					<h4>110Xi4-600dpi</h4></button>
				</div>
				<div class="col-xs-2" id="marginbottom">
					<button class="btn-primary" onclick="shell.openExternal(sixHundredUrl)" type="button"><img alt="" src="img/link.png"></button>
				</div>
				<div class="col-xs-2 col-xs-offset-2">
					<button class="btn-primary" onclick="getThreeHundredData()" type="button"><img alt="" src="img/copy.png"></button>
				</div>
				<div class=" col-xs-4">
					<button class="btn-primary" onclick="phThreeHundred()" type="button">
					<h3>1-NPL-LP-2</h3>
					<h4>110Xi4-300dpi</h4></button>
				</div>
				<div class="col-xs-2" id="marginbottom">
					<button class="btn-primary" onclick="shell.openExternal(threeHundredUrl)" type="button"><img alt="" src="img/link.png"></button>
				</div>
				<div class="col-xs-2 col-xs-offset-2">
					<button class="btn-primary" onclick="getshpOneData()" type="button"><img alt="" src="img/copy.png"></button>
				</div>
				<div class=" col-xs-4">
					<button class="btn-primary" onclick="phshpOne()" type="button">
					<h3>1-SHP-LP-1</h3>
					<h4>Zebra GK420d</h4></button>
				</div>
				<div class="col-xs-2" id="marginbottom">
					<button class="btn-primary" onclick="shell.openExternal(shpOneUrl)" type="button"><img alt="" src="img/link.png"></button>
				</div>
				<div class="col-xs-2 col-xs-offset-2">
					<button class="btn-primary" onclick="getshpTwoData()" type="button"><img alt="" src="img/copy.png"></button>
				</div>
				<div class="col-xs-4">
					<button class="btn-primary" onclick="phshpTwo()" type="button">
					<h3>1-SHP-LP-2</h3>
					<h4>Zebra GK420d</h4></button>
				</div>
				<div class="col-xs-2">
					<button class="btn-primary" onclick="shell.openExternal(shpTwoUrl)" type="button"><img alt="" src="img/link.png"></button>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-offset-4 col-xs-4">
					<button class="btn-primary" onclick="copyToClipboard()" style="height:50%;" type="button">
					<h3>Copy Solution Text</h3></button>
				</div>
			</div>
			<textarea id="test" name=""></textarea> <!-- Modal -->
			<div aria-labelledby="myModalLabel" class="modal fade" id="infoModal" role="dialog" tabindex="-1">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h4 class="modal-title" id="myModalLabel">Instructions</h4><button aria-label="Close" class="close" data-dismiss="modal" type="button"><span aria-hidden="true">&times;</span></button>
						</div>
						<div class="modal-body">
							<ul class='text-left'>
								<li>The first column will copy the printer configurations to your clipboard.</li>
								<li>The second column runs a batch script to reset the printer's inch count.</li>
								<li>The third column will open the printer's webpage.</li>
								<li>The 'Copy Solution Text' button will copy the default ticket solution text to your clipboard. <small>e.g. 'Cleaned Zebra per Manufacturer's Manual'</small></li>
								<li>Next to the information button that loads this modal, is a refresh icon. Once pressed it will refresh the print count for each of the printers.</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<div aria-labelledby="myModalLabel" class="modal fade" id="loadModal" role="dialog" tabindex="-1">
				<div class="modal-dialog" role="document">
					<div style="margin-top:50vh;"><img src='img/loader.gif'></div>
				</div>
			</div>
		</div>
	</div>
	<script>
	        <!-- START JAVASCRIPT VARIABLES -->
	   
			var networkPath = "\\\\LSC-SA-NAS1\\Departments\\Information Technology\\Software\\Zebra Label Printer Reset Counters\\Scripts\\",
	        request = require("request"),
	        cheerio = require("cheerio"),
	        sixHundredUrl = "http://172.16.60.110/config.html", //Variable for 600DPI
	        threeHundredUrl = "http://172.16.60.111/config.html", //Variable for 300DPI
	        shpOneUrl = "http://172.16.60.93/config.html", //Variable for 1-SHP-LP-1
	        shpTwoUrl = "http://172.16.60.92/config.html",
			regex = /((\d?\d?.?\d+) IN) *RESET CNTR2/;
			const remote = require('electron').remote;
	        
	        <!-- END JAVASCRIPT VARIABLES -->
			
			function refreshCount(){
			getSixHundredCurrentCount();
			getThreeHundredCurrentCount();
			getShpOneCurrentCount();
			getShpTwoCurrentCount();
			}
			
			$(window).on('load',function(){
			refreshCount();
			$('#loadModal').modal('show');
			setTimeout(function() {
			$('#loadModal').modal('hide');
			}, 5000);
			});

			function minimizeWindow(){
			var window = remote.getCurrentWindow();
			window.minimize(); 
			}
  
			function closeWindow(){
			var window = remote.getCurrentWindow();
			window.close();
			}

	      //Clean printer on 600DPI
	      function cpSixHundred() {
	        shell.openItem(networkPath + '1-NPL-TXT-1_ResetCounter_2_PrintLengthReached.bat')
	        if (err) {
	          // Ooops.
	          // console.log(stderr);
	          return console.log(err);
	        }

	        // Done.
	        console.log(stdout);
	      };

	      //Clean printer on 300DPI
	      function cpThreeHundred() {
	        shell.openItem(networkPath + '1-NPL-TXT-2_ResetCounter_2_PrintLengthReached.bat')
	        if (err) {
	          // Ooops.
	          // console.log(stderr);
	          return console.log(err);
	        }

	        // Done.
	        console.log(stdout);
	      };

	      //Clean printer 1-SHP-LP-1
	      function cpshpOne() {
	        shell.openItem(networkPath + '1-SHP-LP-1_ResetCounter_2PrintLengthReached.bat')
	        if (err) {
	          // Ooops.
	          // console.log(stderr);
	          return console.log(err);
	        }

	        // Done.
	        console.log(stdout);
	      };

	      //Clean printer 1-SHP-LP-1
	      function cpshpTwo() {
	        shell.openItem(networkPath + '1-SHP-LP-2_ResetCounter_2PrintlengthReached.bat')
	        if (err) {
	          // Ooops.
	          // console.log(stderr);
	          return console.log(err);
	        }

	        // Done.
	        console.log(stdout);
	      };

	      //Printhead replaced on 600DPI
	      function phSixHundred() {
	        shell.openItem(networkPath + '1-NPL-TXT-1_ResetCounter_1_PrintHeadReplaced.bat')
	        if (err) {
	          // Ooops.
	          // console.log(stderr);
	          return console.log(err);
	        }

	        // Done.
	        console.log(stdout);
	      };

	      //Printhead replaced on 300DPI
	      function phThreeHundred() {
	        shell.openItem(networkPath + '1-NPL-TXT-2_ResetCounter_1_PrintHeadReplaced.bat')
	        if (err) {
	          // Ooops.
	          // console.log(stderr);
	          return console.log(err);
	        }

	        // Done.
	        console.log(stdout);
	      };

	      //Printhead replaced on 1-SHP-LP-1
	      function phshpOne() {
	        shell.openItem(networkPath + '1-SHP-LP-1_ResetCounter_1PrintHeadReplaced.bat')
	        if (err) {
	          // Ooops.
	          // console.log(stderr);
	          return console.log(err);
	        }

	        // Done.
	        console.log(stdout);
	      };

	      //Printhead replaced on 1-SHP-LP-1
	      function phshpTwo() {
	        shell.openItem(networkPath + '1-SHP-LP-2_ResetCounter_1PrintHeadReplaced.bat')
	        if (err) {
	          // Ooops.
	          // console.log(stderr);
	          return console.log(err);
	        }

	        // Done.
	        console.log(stdout);
	      };

	   //Functions to grab <pre> data from the printer's configuration page

	      function getThreeHundredData() {
	        request(threeHundredUrl, function(error, response, body) {
	          if (!error) {
	            var $ = cheerio.load(body),
	              threeHundredData = $("pre").html();
	            console.log(threeHundredData);
	            document.getElementById("test").value = threeHundredData;
	            const {
	              clipboard
	            } = require('electron')
	            clipboard.writeText(document.getElementById("test").value);
	            document.getElementById("test").value = "";
	          } else {
	            console.log("We’ve encountered an error: " + error);
	          }
			  getThreeHundredCurrentCount();
	        });
	      }

	      function getSixHundredData() {
	        request(sixHundredUrl, function(error, response, body) {
	          if (!error) {
	            var $ = cheerio.load(body),
	              sixHundredData = $("pre").html();
	            console.log(sixHundredData);
	            document.getElementById("test").value = sixHundredData;
	            const {
	              clipboard
	            } = require('electron')
	            clipboard.writeText(document.getElementById("test").value);
	            document.getElementById("test").value = "";
	          } else {
	            console.log("We’ve encountered an error: " + error);
	          }
			  getSixHundredCurrentCount();
	        });
	      }

	      function getshpOneData() {
	        request(shpOneUrl, function(error, response, body) {
	          if (!error) {
	            var $ = cheerio.load(body),
	              shpOneData = $("pre").html();
	            console.log(shpOneData);
	            document.getElementById("test").value = shpOneData;
	            const {
	              clipboard
	            } = require('electron')
	            clipboard.writeText(document.getElementById("test").value);
	            document.getElementById("test").value = "";
	          } else {
	            console.log("We’ve encountered an error: " + error);
	          }
			  getShpOneCurrentCount();
	        });
	      }

	      function getshpTwoData() {
	        request(shpTwoUrl, function(error, response, body) {
	          if (!error) {
	            var $ = cheerio.load(body),
	              shpTwoData = $("pre").html();
	            console.log(shpTwoData);
	            document.getElementById("test").value = shpTwoData;
	            const {
	              clipboard
	            } = require('electron')
	            clipboard.writeText(document.getElementById("test").value);
	            document.getElementById("test").value = "";
	          } else {
	            console.log("We’ve encountered an error: " + error);
	          }
			  getShpTwoCurrentCount();
	        });
	      }
		  
		  //Get the current printer count and display it with it's limit on the print reset button.
		  
	      function getSixHundredCurrentCount() {
	        request(sixHundredUrl, function(error, response, body) {
	          if (!error) {
	            var $ = cheerio.load(body),
	            currentCount = $("pre").html();
				var captureGroups = regex.exec(currentCount);
				console.log(captureGroups[2]);
				document.getElementById("sixHundredCurrentCount").innerHTML = captureGroups[2] + " / 6,000 IN";
				var captureGroupsNoComma = captureGroups[2].replace (/,/g, "");
				if (captureGroupsNoComma > 6000){
				document.getElementById("sixHundredCurrentCount").style = "color:red;"
				}
				else{
				document.getElementById("sixHundredCurrentCount").style = "color:green;"
				}
			  }else {
			  document.getElementById("threeHundredCurrentCount").innerHTML = "ERROR RETRIEVING COUNT";
			  }
	        });
	      }
		  
	      function getThreeHundredCurrentCount() {
	        request(threeHundredUrl, function(error, response, body) {
	          if (!error) {
	            var $ = cheerio.load(body),
	            currentCount = $("pre").html();
				var captureGroups = regex.exec(currentCount);
				console.log(captureGroups[2]);
				document.getElementById("threeHundredCurrentCount").innerHTML = captureGroups[2] + " / 18,000 IN";
				var captureGroupsNoComma = captureGroups[2].replace (/,/g, "");
				if (captureGroupsNoComma > 18000){
				document.getElementById("threeHundredCurrentCount").style = "color:red;"
				}
				else{
				document.getElementById("threeHundredCurrentCount").style = "color:green;"
				}
 	          }else {
			  document.getElementById("threeHundredCurrentCount").innerHTML = "ERROR RETRIEVING COUNT";
			  }
					        });
	      }
		  
		  

		  
		  function getShpOneCurrentCount() {
	        request(shpOneUrl, function(error, response, body) {
	          if (!error) {
	            var $ = cheerio.load(body),
	            currentCount = $("pre").html();
				var captureGroups = regex.exec(currentCount);
				console.log(captureGroups[2]);
				document.getElementById("shpOneCurrentCount").innerHTML = captureGroups[2] + " / 18,000 IN";
				var captureGroupsNoComma = captureGroups[2].replace (/,/g, "");
				if (captureGroupsNoComma > 18000){
				document.getElementById("shpOneCurrentCount").style = "color:red;"
				}
				else{
				document.getElementById("shpOneCurrentCount").style = "color:green;"
				}
			  }else {
			  document.getElementById("threeHundredCurrentCount").innerHTML = "ERROR RETRIEVING COUNT";
			  }
	        });
	      }
		  
	      function getShpTwoCurrentCount() {
	        request(shpTwoUrl, function(error, response, body) {
	          if (!error) {
	            var $ = cheerio.load(body),
	            currentCount = $("pre").html();
				var captureGroups = regex.exec(currentCount);
				console.log(captureGroups[2]);
				document.getElementById("shpTwoCurrentCount").innerHTML = captureGroups[2] + " / 18,000 IN";
				var captureGroupsNoComma = captureGroups[2].replace (/,/g, "");
				if (captureGroupsNoComma > 18000){
				document.getElementById("shpTwoCurrentCount").style = "color:red;"
				}
				else{
				document.getElementById("shpTwoCurrentCount").style = "color:green;"
				}
			  }else {
			  document.getElementById("threeHundredCurrentCount").innerHTML = "ERROR RETRIEVING COUNT";
			  }
	        });
	      }
		  
	      
	   <!-- Copy 'Cleaned Zebra per Manufacturer's Manual' to clipboard for ticket's solution field -->
	   function copyToClipboard(text) {
	      const {clipboard} = require('electron')
	            console.log("Writing 'Cleaned Zebra per Manufacturer's Manual' to clipboard...");
	            clipboard.writeText("Cleaned Zebra per Manufacturer's Manual");
	            console.log("Success.");
	   }
	</script>
</body>
</html>